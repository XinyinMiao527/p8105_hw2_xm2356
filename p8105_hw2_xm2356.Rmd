---
title: "p8105_hw2_xm2356"
author: "Xinyin Miao (xm2356)"
date: "2025-09-27"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(readxl)
library(knitr)
```

# Problem 1

## Clean data in pols-month

```{r}
## load data
pols_df = read_csv("data/fivethirtyeight_datasets/pols-month.csv")

## clean data
pols_cleaned = pols_df |> 
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) |> 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day),

    month = case_when(
      month == 1 ~ "January", month == 2 ~ "February", month == 3 ~ "March",
      month == 4 ~ "April", month == 5 ~ "May", month == 6 ~ "June",
      month == 7 ~ "July", month == 8 ~ "August", month == 9 ~ "September",
      month == 10 ~ "October", month == 11 ~ "November", month == 12 ~ "December",
      TRUE ~ as.character(month)
    ),
    president = case_when(
      prez_dem == 1 ~ "dem",
      prez_gop == 1 ~ "gop",
      TRUE ~ NA_character_
    )
  ) |> 
  select(-prez_dem, -prez_gop, -day) |> 
  select (year, month, president, everything())
  
pols_cleaned
```

The pols-month.csv dataset contained monthly political control data, including presidential party affiliation (prez_gop/prez_dem) and the distribution of governorships and congressional seats, starting from 1947. 

## Clean data in snp

```{r}
## load data
snp_df = read_csv("data/fivethirtyeight_datasets/snp.csv")

## clean data
snp_cleaned = snp_df |> 
  separate(date, into = c("month_num", "day", "year_short"), sep = "/", convert = TRUE)  |> 

  mutate(
    year = case_when(
      year_short <= 49 ~ year_short + 2000,
      year_short >= 50 ~ year_short + 1900,
    ),
    month = case_when(
      month_num == 1 ~ "January", month_num == 2 ~ "February", month_num == 3 ~ "March",
      month_num == 4 ~ "April", month_num == 5 ~ "May", month_num == 6 ~ "June",
      month_num == 7 ~ "July", month_num == 8 ~ "August", month_num == 9 ~ "September",
      month_num == 10 ~ "October", month_num == 11 ~ "November", month_num == 12 ~ "December",
      TRUE ~ NA_character_
      )
  )  |>  
  select(year, month, snp_value = close) |> 
    # arrange by year and month
  arrange(year, month)

snp_cleaned
```

The snp.csv file provided the monthly closing value of the S&P 500 index, tracking market performance across the period. 

## Clean data in unemployment

```{r}
## load data
unemployment_df = read_csv("data/fivethirtyeight_datasets/unemployment.csv")

## tidy data
unemployment_cleaned = unemployment_df |> 
  rename(year = Year) |> 
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month_abbr",
    values_to = "unemployment_rate"
  ) |> 
mutate(
    month = case_when(
      month_abbr == "Jan" ~ "January", month_abbr == "Feb" ~ "February",
      month_abbr == "Mar" ~ "March", month_abbr == "Apr" ~ "April",
      month_abbr == "May" ~ "May", month_abbr == "Jun" ~ "June",
      month_abbr == "Jul" ~ "July", month_abbr == "Aug" ~ "August",
      month_abbr == "Sep" ~ "September", month_abbr == "Oct" ~ "October",
      month_abbr == "Nov" ~ "November", month_abbr == "Dec" ~ "December",
      TRUE ~ NA_character_
    )
) |> 
select(year, month, unemployment_rate) |> 
arrange(year, month)

unemployment_cleaned
```

The unemployment.csv dataset held the U.S. unemployment rate, originally in a wide format with each month as a separate column. After cleaning and merging, the resulting dataset has 816 observations and 3 variables.

## Join the data

```{r}
merged_df = pols_cleaned |> 
  left_join(snp_cleaned, by = c("year", "month")) |> 
  left_join(unemployment_cleaned, by = c("year", "month"))

merged_df
final_dim = dim(merged_df)
final_years = range(merged_df$year)
final_names = names(merged_df)

final_dim
final_years
final_names
```

This project merged three datasets provided by FiveThirtyEight.
The resulting tidy dataset, created by merging the three files using left_join, has 822 observations and 11 variables. The data spans the years from 1947 to 2015. Key variables include year, month, president, snp_value, and unemployment_rate.


# Problem 2

```{r}
clean_trash_wheel = function(file_path, wheel_name) {
  read_csv(file_path, skip = 1) |> 
    janitor::clean_names() |> 
    filter(!is.na(weight_tons), weight_tons > 0) |> 
  mutate(
      sports_balls = as.integer(round(sports_balls)),
      
      wheel_name = wheel_name,
      
      year = as.integer(year),
      month = as.integer(month)
    ) |> 
  select(wheel_name, dumpster, date, year, month, weight_tons, plastic_bags, 
           foam_containers = polystyrene, cigarette_butts, sports_balls, everything())
}
```













